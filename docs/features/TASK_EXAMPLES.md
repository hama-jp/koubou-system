# 📋 工房システム - タスク処理の実例

## 親方（Claude Code）から職人（ローカルLLM）への委譲タスク

### 🎯 実際に処理されるタスクの種類

#### 1. 🔧 コード生成タスク（TYPE: CODE）
職人がCodex CLI経由でコードを生成する案件

**例1: REST API作成**
```
親方: "REST APIエンドポイントを作成してください。ユーザー認証機能付きで、
      JWT トークンを使用し、ユーザーのCRUD操作ができるようにしてください。"

職人の作業: 
- Flask/FastAPIでのエンドポイント実装
- JWT認証ミドルウェアの作成
- ユーザーモデルとCRUD操作の実装
優先度: 8/10
処理時間: 約45-60秒
```

**例2: Reactコンポーネント作成**
```
親方: "TypeScriptでReactコンポーネントを作成。カスタムフックを使用して
      APIからデータを取得し、ローディング状態とエラーハンドリングを実装してください。"

職人の作業:
- TypeScriptでの型定義
- カスタムフック（useFetch等）の実装
- ローディング/エラー表示コンポーネント
優先度: 9/10
処理時間: 約30-45秒
```

**例3: テストコード作成**
```
親方: "calculator.pyファイルに対する包括的なユニットテストをpytestで作成。
      エッジケースとエラー処理を含めてください。"

職人の作業:
- pytestでのテストクラス作成
- 正常系・異常系テストケース
- パラメトライズドテスト
優先度: 7/10
処理時間: 約20-30秒
```

#### 2. 💬 一般質問タスク（TYPE: GENERAL）
職人がOllama直接で回答する案件

**例1: 技術説明**
```
親方: "Pythonでデコレーターパターンを実装する方法と、
      実際の使用例を3つ教えてください。"

職人の作業:
- デコレーターの基本説明
- 実装例（ログ、キャッシュ、認証）
- コードサンプル付き説明
優先度: 5/10
処理時間: 約10-15秒
```

**例2: アーキテクチャ分析**
```
親方: "マイクロサービスアーキテクチャの利点と欠点を説明してください。"

職人の作業:
- 利点の列挙（スケーラビリティ、独立性等）
- 欠点の説明（複雑性、通信オーバーヘッド等）
- 適用場面の提案
優先度: 4/10
処理時間: 約15-20秒
```

**例3: コードレビュー**
```
親方: "このコードのパフォーマンスボトルネックを特定し、
      最適化案を提案してください: [コードスニペット]"

職人の作業:
- ボトルネック箇所の特定
- O(n)分析
- 最適化提案（アルゴリズム改善、キャッシュ等）
優先度: 6/10
処理時間: 約20-30秒
```

### 📊 タスクの優先度と処理順序

```
優先度 10: 緊急のバグ修正、本番環境の問題
優先度 8-9: 重要な機能実装、APIエンドポイント作成
優先度 6-7: テスト作成、リファクタリング
優先度 4-5: 一般的な質問、説明要求
優先度 1-3: ドキュメント生成、軽微な改善
```

### ⚙️ 処理フロー

```
1. 親方（Claude Code）がユーザーからリクエスト受信
   ↓
2. タスクを分析して職人に委譲可能か判断
   ↓
3. タスクをキューに追加（優先度付き）
   ↓
4. 空いている職人（Worker）がタスクを取得
   ↓
5. タスクタイプに応じて処理
   - CODE → Codex CLI → Ollama (gpt-oss:20b)
   - GENERAL → Ollama直接
   ↓
6. 結果を親方に返却
   ↓
7. 親方がユーザーに最終結果を提供
```

### 🎯 実際の処理統計（典型的な1時間）

```
総タスク数: 約100件
├── コード生成: 40件（40%）
│   ├── API作成: 10件
│   ├── コンポーネント: 15件
│   ├── テスト: 10件
│   └── その他: 5件
├── 一般質問: 35件（35%）
│   ├── 技術説明: 20件
│   ├── ベストプラクティス: 10件
│   └── トラブルシューティング: 5件
├── コードレビュー: 15件（15%）
└── リファクタリング: 10件（10%）

平均処理時間: 25秒
成功率: 96.9%
同時処理ワーカー数: 1-3（動的調整）
```

### 🚨 失敗するタスクの例

**タイムアウト（120秒超過）**
```
親方: "プロジェクト全体をTypeScriptに移行してください"
→ 範囲が広すぎて処理不可
```

**ファイル不在エラー**
```
親方: "production.pyファイルのバグを修正してください"
→ ファイルが存在しない
```

**権限エラー**
```
親方: "システムファイルを変更してください"
→ Codexのサンドボックス制限
```

### 💡 最適化のヒント

1. **バッチ処理**: 関連するタスクをまとめて送信
2. **優先度設定**: 重要なタスクに高い優先度を設定
3. **タスク分割**: 大きなタスクは小さく分割
4. **キャッシュ活用**: 類似タスクの結果を再利用

---

これが工房システムで実際に処理されているタスクの詳細です。
親方（Claude Code）が複雑な作業を適切に分解し、
職人（ローカルLLM）たちが並列で効率的に処理しています！